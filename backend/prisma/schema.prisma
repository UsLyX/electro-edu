generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  id           Int        @id @default(autoincrement())
  lastName     String
  firstName    String
  email        String     @unique
  password     String
  class        Class      @relation(fields: [classId], references: [id])
  middleName   String?
  phone        String?    @unique
  dateOfBirth  DateTime?
  dateRegister DateTime   @default(now())
  classId      Int
  status       userStatus @default(PROCESSING)
  Answer       Answer[]
}

model Teacher {
  id           Int             @id @default(autoincrement())
  lastName     String
  firstName    String
  email        String          @unique
  password     String
  predmets     TeacherLesson[]
  middleName   String?
  phone        String?         @unique
  dateOfBirth  DateTime?
  dateRegister DateTime        @default(now())
  status       userStatus      @default(PROCESSING)
}

model TeacherLesson {
  lesson     Lesson  @relation(fields: [lessonName], references: [lessonName])
  lessonName String
  teacher    Teacher @relation(fields: [teacherID], references: [id])
  teacherID  Int

  @@id([lessonName, teacherID])
}

model Lesson {
  id            Int             @id @default(autoincrement())
  lessonName    String          @unique
  TeacherLesson TeacherLesson[]
  ClassLessons  ClassLessons[]
}

model Class {
  id           Int            @id @default(autoincrement())
  className    String         @unique
  Student      Student[]
  ClassLessons ClassLessons[]
}

model ClassLessons {
  id         Int        @id @default(autoincrement())
  class      Class      @relation(fields: [classId], references: [id])
  classId    Int
  lesson     Lesson     @relation(fields: [lessonName], references: [lessonName], onDelete: Cascade)
  lessonName String
  questions  Question[]
}

model Question {
  id                  Int          @id @default(autoincrement())
  classLesson         ClassLessons @relation(fields: [classLessonId], references: [id], onDelete: Cascade)
  classLessonId       Int
  questionDescription String
  dateCreate          DateTime     @default(now())
  files               String[]
  answers             Answer[]
}

model Admin {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
}

model Answer {
  id         Int          @id @default(autoincrement())
  Question   Question    @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId Int
  student    Student      @relation(fields: [studentId], references: [id])
  studentId  Int
  files      String[]
  score      studentScore @default(NOSCORE)
  dateAnswer DateTime     @default(now())
}

enum userStatus {
  ACCEPTED
  REJECTED
  PROCESSING
}

enum studentScore {
  PERFECT
  GOOD
  SATISFACTORY
  BAD
  NOSCORE
}
